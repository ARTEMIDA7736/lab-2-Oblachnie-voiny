# Лабораторная работа №2 (DevOps)
## Задание: 
Написать два Dockerfile – плохой и хороший. Плохой должен запускаться и работать корректно, но в нём должно быть не менее 3 “bad practices”. В хорошем Dockerfile они должны быть исправлены. В Readme описать все плохие практики из кода Dockerfile и почему они плохие, как они были исправлены в хорошем  Dockerfile, а также две плохие практики по использованию этого контейнера
## Участники:
- Залетов Артём 
- Космач Мария
- Алексей Цыпандин
- Клименков Владислав
## Выполнение работы:
### Этап №1, подготовка к выполнению работы.
Перед выполнением данной работы нашей команде для начала нужно было определится с тем, какое приложение мы будем использовать для работы с файлами docker. И, немного подумав, наш выбор пал на Docker desktop. Это приложение мы выбрали по нескольким причинам.
- Простой и интуитивно понятный интерфейс приложения.
- Ознакомительные гайды для начала работы с докером.
### Этап №2, написание docker файлов.
Поскольку особых навыков по работе с docker файлами у нас не было, мы решили не мудрить, и написать небольшие docker файлы, которые бы помогали нам развернуть свой сервер на базе Apache и передать туда файлик с версткой нашего проекта(может быть и не только проекта). Ниже, предоставлены листинги кода для "плохого" b "хорошего" docker файла.

__Плохой docker__

```
FROM debian:latest
RUN apt-get update
RUN apt-get install apache2

EXPOSE 8080

RUN echo "<!DOCTYPE html> <html> <head> <title>!DOCTYPE</title> <meta charset="utf-8"> </head> <body> <p>Разум — это Будда, а прекращение умозрительного мышления — это путь.Перестав мыслить понятиями и размышлять о путях существования и небытия, о душе и плоти, о пассивном и активном и о других подобных вещах,начинаешь осознавать, что разум — это Будда, что Будда — это сущность разума, и что разум подобен бесконечности.</p> </body> </html>" > /var/www/html/index.html

CMD ["apache2ctl", "FOREGROUND"]
```
__И наконец хороший docker__
```
FROM debian:bullseye

RUN apt-get update  && apt-get install apache2  

COPY index.html /var/www/html/

EXPOSE 8080

CMD ["apache2ctl", "FOREGROUND"]
```

__Давайте разберем и поймем, какие плохие практики  были использованы в первом docker файле.__

- В плохом docker файле, в первой строчке мы написали `FROM debian:latest` , это не есть гуд так как при обновлениях могут возникнуть проблемы совместимости и сделать наш docker нерабочим.
- Теперь взглянем на команду `RUN echo` , я специально сделал её такой большой чтобы стало понятно, что её лучше не использовать, это уменьшит читаемость кода и при наличии ошибок их будет очень трудно исправить, тем более, я вставил туда относительно небольшую верстку, которая выводит мудрое изречение одного философа, а если мы хотим загрузить целую страницу на 500+ строк кода, то это будет совсем тяжело, поэтому, поправим в хорошем Docker файле.
- Последней плохой практикой является разбивка одного действия на много разных команд `RUN`, все это увеличивает количество слоев и приводит к увеличению расходов на запуск, что не есть гуд.

__Давайте теперь разберем, что мы исправили.__

- Первое, что мы сделали это прописали конкретную версию для Debian, сделали мы это командой `FROM debian:bullseye` мы больше не будем загружать последнюю версию Debian, а 11.XX, если я не ошибаюсь, то это Debian версии 11.
- Также, мы уменьшили количесво слоёв, просто объединив две команды `RUN`, так код стал читабельнее и менее ресурсозатратным.
- Мы сделали так, чтобы вместо длинющей команды, мы могли бы создать файлик, который называется `index.html` (Традиционное название для основного файла), в него мы добавили верстку, которую раньше передавали при помощи команды ECHO.
- Хотя мы этого не исправляли, но мы используем непривилигированный порт, что также является хорошей практикой при написании Docker файлов.
### Этап №3, пробуем запуститься.
Для того, чтобы развернуть веб-сервер на Apache, нам необходимо для начала открыть CMD или Powershell, не важно и прописать следующую команду.

`Docker image build -t [название образа] [Путь к docker файлу]`

__Наша команда выглядела так для хорошего docker файла__

`Docker image build -t dockergood D:\`

__А так для плохого__

`Docker image build -t dockerbad2 D:\`

После того, как мы создали образы, их нужно запустить, для этого мы напишем следующие команды:

`Docker run -p [Номер порта] [Название образа]`

__Наша команда выглядела так для хорошего docker файла__

`Docker run -p 8080:80 dcokerbad2`

__А так для плохого__

`Docker run -p 8080:80 dcokergood`

После всех эти манипуляций у нас появится сообщение, которое предупреждает нас о том, что у сервера отсутствует доменное имя, это можно пропустить так как на работу это не влияет. Ниже представленны скриншоты прописанных команд и результат их выполнения.


![Командная строка 05 11 2023 20_26_27](https://github.com/ARTEMIDA7736/lab-2-Oblachnie-voiny/assets/112976222/17b8f964-a12b-4772-8226-d51ddb2cf05b)

![Администратор_ Командная строка 05 11 2023 19_56_47](https://github.com/ARTEMIDA7736/lab-2-Oblachnie-voiny/assets/112976222/3b9658fd-2b5f-41cd-b139-e69e896e2cf1)

Также, все наши контейнеры и образы сразу же отобразятся в Docker desctop, их можно запускать напрямую оттуда без захода в консоль(Ниже скрины из Docker desctop c созданными контейнерами и образами).

![Containers - Docker Desktop  DEV  05 11 2023 20_29_08](https://github.com/ARTEMIDA7736/lab-2-Oblachnie-voiny/assets/112976222/7d082be0-7b3e-4a22-81c3-035525187680)

![Containers - Docker Desktop  DEV  05 11 2023 20_29_05](https://github.com/ARTEMIDA7736/lab-2-Oblachnie-voiny/assets/112976222/a149cc2a-7582-4b1d-875b-b803ff8252fb)

И наконец, чтобы понять что сервер работает мы просто через docker desktop перейдем на страницу, которую мы только что создали по одному клику.(Скриншот страницы для двух докеров ниже)
![!DOCTYPE и еще 3 страницы — Личный_ Microsoft​ Edge 05 11 2023 20_12_17](https://github.com/ARTEMIDA7736/lab-2-Oblachnie-voiny/assets/112976222/fef2589a-7239-41a1-ae9d-49c2cf5a070c)

__Работа выполнена!!!__
### Этап №4, плохие практики при использовании данного контейнера.
- Если мы не будем регулярно обновлять базовый образ (в данном случае Debian Bullseye) и установленные в нем пакеты, это может привести к наличию уязвимостей в контейнере. Поэтому регулярно надо обновлять базовый образ и пакеты, чтобы обеспечить безопасность контейнера.
- Использование слишком объемных или тяжелых образов может привести к увеличению времени скачивания и запуска контейнера и увеличению потребления ресурсов. Лучше использовать минимально необходимые образы и оптимизировать их размер для уменьшения времени и затрат на работу с контейнером.
- В наш Dockerfile устанавливает Apache и копирует файл index.html. Однако, размер контейнера может быть большим из-за лишних файлов и зависимостей, которые не используются. Чтобы оптимизировать размер контейнера можно удалять ненужные файлы и зависимости после установки Apache.
  

### Вывод по лабораторной работе.

В данной лабораторной работе мы научились работать с docker файлами, написали свои и изучили их на предмет хороших/плохих практик.

